---
title: "ETF Data Analysis"
format: 
  html:
    code-fold: true
    code-summary: "Show Code"
vignette: >
  %\VignetteIndexEntry{ETF Data Analysis}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
execute:
  eval: false
---

```{r}
#| label: setup
#| include: false
library(etfdata)
library(targets)
library(ggplot2)
library(dplyr)
```

## ETF Universe

We start by defining the universe of European UCITS ETFs.

```{r universe-code}
get_etf_universe()
```

## Metadata (JustETF)

We scraped JustETF for metadata including AUM and TER.

```{r metadata-code}
# Code used:
# fetch_etf_metadata(universe$isin)
```

## Price History (Yahoo Finance)

We fetched daily price history.

```{r history-plot}
# Visualize Close Prices
# history %>%
#   ggplot(aes(x = date, y = close, color = ticker)) +
#   geom_line() +
#   facet_wrap(~ticker, scales = "free_y") +
#   labs(title = "ETF Price History (LSE)", y = "Close Price (GBP)") +
#   theme_minimal()
```

## Combined Analysis

Relationship between AUM and Liquidity (Volume)?

```{r combined}
# Join data
# avg_vol <- history %>%
#   group_by(ticker) %>%
#   summarise(avg_daily_vol = mean(volume, na.rm = TRUE))
# 
# combined <- universe %>%
#   inner_join(metadata, by = "isin") %>%
#   inner_join(avg_vol, by = "ticker")
#   
# knitr::kable(head(combined))
```