---
title: "etfdata in WebAssembly (WASM)"
format: html
filters:
  - webr
engine: knitr
vignette: >
  %\VignetteIndexEntry{etfdata in WebAssembly (WASM)}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

This vignette demonstrates the `etfdata` package running entirely in your browser using [WebR](https://docs.r-wasm.org/webr/latest/).

## Interactive R Console

You can run R code directly below. Press "Run Code" to execute.

```{webr-r}
#| caption: "Check WebR Environment"
version$version.string
```

## Installing Dependencies

We need to install `etfdata` dependencies from the WASM package repository.

```{webr-r}
#| caption: "Install Packages"
# Install dependencies available in WASM
install.packages(c("dplyr", "ggplot2", "tidyr"))

# Note: 'etfdata' requires compilation. 
# Unless a pre-compiled WASM binary is hosted (e.g. on R-Universe), 
# installing from source will fail if it needs system libs (like curl/xml2).
# This is a demonstration of the attempt:
tryCatch({
  install.packages("etfdata", repos = "https://johngavin.r-universe.dev")
}, error = function(e) {
  message("etfdata could not be installed in WASM: ", e$message)
})
```

## Data Analysis Example

If `etfdata` is not available, we simulate the data structure to demonstrate the analysis workflow in WebR.

```{webr-r}
#| caption: "Interactive Plotting"
library(dplyr)
library(ggplot2)

# Simulated universe if package missing
universe <- tibble(
  ticker = c("VUSA.L", "CSPX.L", "INRG.L"),
  name = c("Vanguard S&P 500", "iShares Core S&P 500", "iShares Clean Energy"),
  currency = "GBP"
)

print(universe)

# Create a dummy plot
df <- data.frame(
  x = rnorm(100),
  y = rnorm(100)
)

ggplot(df, aes(x, y)) +
  geom_point(color = "blue") +
  theme_minimal() +
  labs(title = "Interactive Plot in WebR")
```